# Отчет по Лабораторной работе 8

**Автор:** Зекин В.К., группа P3121
**Тема:** Клиент-серверное приложение с архитектурой MVC

## Цель работы

Создать простое клиент-серверное приложение на Python без использования серверных фреймворков. Освоить работу с HTTPServer, маршрутизацией запросов, шаблонизатором Jinja2 и реализовать модели предметной области с геттерами и сеттерами.

## Описание предметной области

### Модели данных

1. **Author** - автор приложения
   - `name` - имя автора
   - `group` - учебная группа

2. **App** - метаданные приложения
   - `name` - название приложения
   - `version` - версия
   - `author` - объект Author

3. **User** - пользователь системы
   - `id` - уникальный идентификатор
   - `name` - имя пользователя
   - `subscriptions` - подписки на валюты

4. **Currency** - валюта с курсом
   - `id` - уникальный идентификатор
   - `num_code` - цифровой код
   - `char_code` - символьный код
   - `name` - название
   - `value` - курс
   - `nominal` - номинал

5. **UserCurrency** - связь пользователей и валют
   - `id` - уникальный идентификатор
   - `user_id` - ID пользователя
   - `currency_id` - ID валюты
   - `notification_threshold` - порог уведомлений

## Структура проекта

```
Lab8/
├── models/                 # Модели (MVC - Model)
│   ├── __init__.py        # Импорт всех моделей
│   ├── author.py          # Класс Author
│   ├── app.py             # Класс App
│   ├── user.py            # Класс User
│   ├── currency.py        # Класс Currency
│   └── user_currency.py   # Класс UserCurrency
├── templates/              # Шаблоны (MVC - View)
│   ├── index.html         # Главная страница
│   ├── users.html         # Список пользователей
│   ├── user_detail.html   # Детали пользователя
│   ├── currencies.html    # Курсы валют
│   └── author.html        # Информация об авторе
├── utils/                  # Утилиты
│   └── currencies_api.py  # Функция get_currencies
├── tests/                  # Тесты
│   ├── __init__.py
│   ├── test_models.py     # Тесты моделей
│   └── test_currencies_api.py # Тесты API
├── static/                 # Статические файлы
├── myapp.py               # Основной файл (MVC - Controller)
├── requirements.txt       # Зависимости
└── README.md             # Документация
```

## Реализация компонентов

### 1. Модели (Models)

Все модели реализованы с использованием принципов инкапсуляции:

- Приватные поля с префиксом `_`
- Публичные свойства через `@property` декораторы
- Валидация данных в сеттерах
- Генерация UUID для уникальных идентификаторов

**Пример валидации в модели Currency:**
```python
@property
def value(self) -> float:
    return self._value

@value.setter
def value(self, value: float) -> None:
    if not isinstance(value, (int, float)):
        raise ValueError("Value must be a number")
    if value < 0:
        raise ValueError("Value cannot be negative")
    self._value = float(value)
```

### 2. Контроллер (HTTPServer)

Реализован кастомный обработчик запросов `CurrencyRequestHandler`:

- Маршрутизация через `self.path`
- Обработка GET и POST запросов
- RESTful API эндпоинты
- Интеграция с Jinja2

**Маршруты:**
- `/` - главная страница
- `/users` - список пользователей
- `/user?id=...` - детали пользователя
- `/currencies` - курсы валют
- `/author` - информация об авторе

### 3. Представления (Jinja2 Templates)

Использование шаблонизатора Jinja2:

- Инициализация `Environment` один раз при старте
- Наследование переменных в шаблонах
- Циклы и условия для отображения данных
- Минималистичный дизайн без излишней стилизации

**Пример шаблона:**
```html
{% for user in users %}
<div class="user-card">
    <h3>{{ user.name }}</h3>
    <p>ID: {{ user.id[:8] }}...</p>
</div>
{% endfor %}
```

### 4. Интеграция с API валют

Функция `get_currencies` интегрирована для:

- Получения актуальных курсов ЦБ РФ
- Обработки ошибок сети
- Валидации полученных данных
- Кеширования в памяти сервера

## Тестирование

Реализованы unit-тесты для:

1. **Моделей** (`test_models.py`)
   - Валидация данных
   - Создание объектов
   - Проверка геттеров/сеттеров
   - Обработка некорректных данных

2. **API валют** (`test_currencies_api.py`)
   - Успешное получение данных
   - Обработка ошибок соединения
   - Валидация JSON
   - Поиск конкретных валют

**Запуск тестов:**
```bash
python -m pytest tests/
```

## Примеры работы приложения

### Главная страница
- Отображает информацию о приложении
- Навигационное меню
- Данные об авторе

### Страница валют
- Таблица с курсами валют
- Фильтр по названию/коду
- Кнопка обновления
- Статистика

### Управление пользователями
- Список всех пользователей
- Добавление новых пользователей
- Просмотр подписок
- Подробная информация

## Выводы

В ходе выполнения лабораторной работы были решены следующие задачи:

1. **Изучена архитектура MVC** - четкое разделение ответственности между моделями, представлениями и контроллером.

2. **Освоен HTTPServer** - создание веб-сервера без использования фреймворков, включая маршрутизацию и обработку запросов.

3. **Применен Jinja2** - шаблонизация HTML с использованием переменных, циклов и условий.

4. **Реализованы модели** - классы предметной области с полной инкапсуляцией и валидацией данных.

5. **Интегрировано API** - получение и обработка данных от внешнего сервиса ЦБ РФ.

6. **Созданы тесты** - модульное тестирование с использованием unittest и mock.

Приложение полностью соответствует требованиям ТЗ, использует минималистичный дизайн и готово для дальнейшего расширения функционала.